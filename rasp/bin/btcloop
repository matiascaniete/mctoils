#!/usr/bin/env bash

ANIM_DELAY=0.01

frame() {
	echo "$1"
	sleep $ANIM_DELAY
}

animation() {
	frame "-"
	frame " -"
	frame "  -"
	frame "   -"
	frame "    -"
	frame "     -"
	frame "      -"
	frame "       -"
	frame "      -"
	frame "     -"
	frame "    -"
	frame "   -"
	frame "  -"
	frame " -"
	frame "-"
	frame ""
}

get-time() {
	date +"%H. %M. %S"
}

get-date() {
	date +"%Y.%m.%d"
}

get-load() {
	cat /proc/loadavg | cut -f1 -d " "
}

showtime() {
	anim-in "$(get-time)"
	for i in $(seq 1 "$1"); do
		get-time
		sleep 1
	done
	anim-out "$(get-time)"
}

showdate() {
	anim-in "$(get-date)"
	sleep "$1"
	anim-out "$(get-date)"
}

title() {
	anim-in "$1"
	sleep "$2"
	anim-out "$1"
}

showbtc() {

	anim-in "   btc"
	sleep 1
	anim-out "   btc"

	BTC="$1"
	A="         "
	B=$(LC_NUMERIC="en_US.UTF-8" printf "%.2f" "$BTC")
	C="${A:0:-${#B}}$B"

	anim-in "$C"
	sleep "$2"
	anim-out "$C"
}

showload() {
	anim-in "load $(get-load)"
	for i in $(seq 1 "$1"); do
		echo "load $(get-load)"
		sleep 1
	done
	anim-out "load $(get-load)"
}

anim-in() {
	TEXT="$1"

	echo ""
	sleep $ANIM_DELAY
	for i in $(seq 1 ${#TEXT}); do
		echo "$TEXT" | cut -b "1-$i"
		sleep $ANIM_DELAY
	done
}

anim-out() {
	TEXT="$1"

	for i in $(seq ${#TEXT} -1 1); do
		echo "$TEXT" | cut -b "1-$i"
		sleep $ANIM_DELAY
	done

	echo ""
	sleep $ANIM_DELAY
}

while :; do
	BTC=$(btc)
	TOTAL=5
	for i in $(seq 1 $TOTAL); do
		animation
		title "$i-$TOTAL" 1
		animation
		showdate 10
		animation
		showtime 20
		animation
		showload 10
		animation
		showbtc "$BTC" 20
	done
done
